# はじめに

このたびは「VRChat Chatbox Sender」をダウンロードいただきありがとうございます。

このツールは、VRChatのチャットボックスに外部からメッセージを送信できる、Webベースのチャット支援ツールです。OSCを経由して、PCやスマートフォンのブラウザから直接文字入力が可能です。

※本ツールはChatGPTを活用して開発されました。

---

## 必要なもの

- [Node.js](https://nodejs.org)
- 任意のブラウザ

---

## 導入手順

- コマンドプロンプト（cmd）を開きます。

１.Windowsのスタートボタンをクリック

２.「cmd」と入力して「コマンドプロンプト」をクリック  
※「管理者権限で実行」ではなく、「開く」の方から実行してください   
※「エクスプローラー」の「ターミナルで開く」は`Power Shell`を開くので、必ずこの手順で`cmd`を使ってください。   
※`Power Shell`では実行できません。理由はトラブルシューティングをご確認ください。

- フォルダに移動します。

たとえば、解凍したフォルダがデスクトップにある場合：

`cd Desktop\osc-chatbox-server-public_1.1`  
※ フォルダ名は実際の名前に合わせて入力してください。  
※ cd は "Change Directory（フォルダを移動）" の意味です。

### 必要な物を準備をします（初回のみ）

次のコマンドを入力して、必要なプログラムを自動でインストールします：

`npm install express osc`

---

## 起動方法

### 方法1：boot.bat から起動（簡単）

- `boot.bat` をダブルクリックで実行すると、コマンドライン操作なしで起動できます。

### 方法2：コマンドラインから起動

- コマンドライン（ターミナル）を開き、以下のコマンドを実行します：

- `npm start` または `node server.js`


---

## 終了方法

- コマンドラインで `Ctrl + C` を押すことで、サーバーを終了できます。

---

## 使用方法

1. 起動後、コマンドラインに「サーバー起動中！ http://(IPアドレス):3000」と表示されます。
2. 表示されたURLをスマートフォンやPCのブラウザに入力すると、ツール画面が表示されます。

---

## 画面の説明

1. 一番上にテキストボックスがあり、メッセージを入力できます。
2. その下に各種ボタンが並んでおり、それぞれの機能を実行できます。
3. **「定型文」** エリアでは、設定済みの定型文をすぐに入力できます。
4. **「定型文編集エリア」** では、最大10個まで定型文をカスタマイズ可能です。
5. **「メッセージ履歴」** には、最大10件まで送信済みのメッセージが表示されます。  
履歴からの選択で、メッセージをコピーできます。  
（※コピーはシステムのクリップボードには保存されません）
6. **「コピー用チャット表示」** では、下のテキストボックスに入力したテキストは送信すると、VRChatのキーボードに表示することができます。

---

## 各機能の説明

- **「Enterキーで送信する」**  
Enterキーで送信するかどうかを切り替えられます（デフォルトはオフ）。設定は保存されます。

- **「取り消し」**  
テキストボックスの入力内容を消去します。

- **「カット」**  
入力中のメッセージを一時保存します。  
（ローカルメモリ上。システムのクリップボードにはコピーされません）

- **「ペースト（カット）」**  
カット機能で保存した内容をテキストボックスに貼り付けます。

- **「ペースト（履歴）」**  
メッセージ履歴から選択した内容をテキストボックスに貼り付けます。

- **「送信！」**  
テキストボックスの内容をVRChatのチャットボックスに送信します。

- **「通知音を鳴らす」**
メッセージを送信した際にVRChat上で通知音を鳴らすかどうか設定できます（デフォルトはオン）

- **「定型文」**  
登録済みの定型文をワンクリックで入力できます。

- **「定型文編集エリア」**  
定型文を編集できます（最大10件まで）。

- **「定型文を保存」**  
編集した定型文を保存します（ローカルストレージに記録されます）。

- **「定型文を初期化」**  
定型文を初期状態に戻します。

- **「コピー用に表示」**
コピー用のテキストボックスで送信したテキストをVRChatのキーボードに表示します。   
動画のURLをコピーしたい際や、日本語テキストをコピーしたい際などにご活用ください。

---

## 備考

- このツールはローカルネットワーク内で動作します。インターネット経由での利用には追加の設定が必要です。
- VRChatのOSC機能が有効になっている必要があります。

---

## トラブルシューティング（よくある質問と対処法）
### `npm` や `node` のコマンドが使えない / エラーが出る  

- **原因**： **Node.js** が正しくインストールされていないか、環境変数の設定ができていません。  
（環境変数とは...？  
例えば、Node.js をインストールすると、自動でこの「道しるべ」に登録されますが、うまく登録されないと「そんなコマンド知らない」とエラーが出ることがあります。）

### 対処法：

[Node.js公式サイト](https://nodejs.org/)から最新版をインストールしてください。

インストール後、コマンドプロンプトを再起動してから再度お試しください。

### **PowerShell で スクリプトの実行が無効になっているため... と出る**  

- **原因**： PowerShellの実行ポリシーにより`npm`などがブロックされています。

### 対処法：

**コマンドプロンプト（cmd）** を使って実行してください （**PowerShellではなく**）。

### 他のPCやスマホからアクセスできない（応答時間が長すぎますなど）

- **原因１**： **Windowsファイアウォール**でブロックされている可能性があります。

### 対処法：

Windows Defenderファイアウォールの「受信の規則」で、ポート3000を許可してください。

1. 「Windows セキュリティ」を開く。

2. 左メニューの「ファイアウォールとネットワーク保護」→「詳細設定」。

3. 「受信の規則」をクリック → 右側の「新しい規則」。

4. 以下のように設定：

- 種類：ポート

- プロトコル：TCP

- 特定のローカルポート：3000

- アクション：接続を許可する

- 適用対象：すべてにチェック

- 名前：任意（例：VRChat Chatbox Sender）

また、「VRChat Chatbox Sender」の起動時に表示される「アクセス許可」ダイアログが出たら、「アクセスを許可」してください。

- **原因２**： PCが**正しいIPアドレス**を使っていない、または**同じWi-Fi**に接続していない。

### 対処法：

`ipconfig`コマンドでIPv4アドレスを確認し、正しいIPを使用してください。

アクセスするスマホや他のPCが **同じネットワーク内（同じWi-Fi）** にあるか確認してください。

### VRChat側にメッセージが送信されない

- **原因**： VRChatのOSC機能が有効になっていない可能性があります。

### 対処法：

VRChatの設定から「OSC」を有効にしてください。

OSCのIPアドレス・ポート設定がデフォルトのままであることを確認してください（127.0.0.1:9000）。

### boot.bat が開かない / 一瞬で閉じてしまう

- **原因**： batファイルがエラーで終了している可能性があります。

### 対処法：

代わりにコマンドプロンプトで手動起動してください：

`npm start`

### 起動後、画面が真っ白で何も表示されない

- **原因**： ブラウザのキャッシュが原因の場合があります。

### 対処法：

ページをリロードするか、`Ctrl + F5` を押してキャッシュをクリアしてみてください。

それでも表示されない場合は、別のブラウザ（例：Chrome）をお試しください。

### 起動時に、「Error:bind EADDRINUSE 0.0.0.0:9001...」と表示されて起動しない

- **原因**：サーバーが使用しようとしている UDPポート 9001 がすでに他のプロセスによって使用中のため、バインド（割り当て）できない場合に発生します。

### 対処法：   

1. すでにこのアプリを別ウィンドウや別プロセスで起動していないか確認してください。   
→起動済みの場合は、タスクマネージャーから`Node.js`プロセスを終了してください。
2. 他にOSCを活用したVRCチャット支援ツールを起動していないか確認してください。   
→起動している場合は、そちらのプロセスを終了してからこのツールを起動してください。
3. PCを再起動することで使用中のポートを開放するのも有効です。